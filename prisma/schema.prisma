generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGODB_URI")
}

type AdminState {
  blockReason String   @default("")
  isBlocked   Boolean  @default(false)
  updatedAt   DateTime @default(now())
}

type Images {
  createdAt     DateTime
  feedback      String
  messageId     Int
  prompt        String
  revisedPrompt String?
  updatedAt     DateTime
  urls          String[]
}

type Messages {
  createdAt DateTime  @default(now())
  feedback  String
  messageId Int
  messages  Message[]
  updatedAt DateTime  @default(now())
}

type Message {
  content String
  role    String
}

type ClientAccountLevel {
  expiresAt DateTime
  gptModels String[]
  gptTokens Int
  images    Int
  name      String
  symbol    String
}

type ClientMetadata {
  firstname    String  @default("en")
  languageCode String  @default("")
  lastname     String?
  username     String?
}

type ClientState {
  blockReason String   @default("")
  isApproved  Boolean  @default(false)
  isBlocked   Boolean  @default(false)
  updatedAt   DateTime @default(now())
}

model Admin {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime   @default(now())
  email     String     @unique
  password  String
  role      String     @default("moderator")
  state     AdminState
  username  String

  @@map("admins")
}

model ClientImages {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  images     Images[]
  telegramId Int      @unique
  client     Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId   String   @unique @map("client") @db.ObjectId

  @@map("clientimages")
}

model ClientMessages {
  id         String     @id @default(auto()) @map("_id") @db.ObjectId
  messages   Messages[]
  telegramId Int        @unique
  client     Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId   String     @unique @map("client") @db.ObjectId

  @@map("clientmessages")
}

model Client {
  id           String             @id @default(auto()) @map("_id") @db.ObjectId
  accountLevel ClientAccountLevel
  createdAt    DateTime           @default(now())
  images       ClientImages?
  messages     ClientMessages?
  metadata     ClientMetadata
  state        ClientState
  telegramId   Int                @unique

  @@map("clients")
}

model GptModels {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  associated  String[]
  creator     String
  description String
  max         Int?
  model       String   @unique
  title       String
  type        String   @default("text")

  @@map("gptmodels")
}
